-- SQL Server Database script

USE master
GO
-- Drop database if existing
DROP DATABASE FS3SimulationDatabase
GO
-- Create database
CREATE DATABASE FS3SimulationDatabase
GO

USE FS3SimulationDatabase
GO

-- Create user table
CREATE TABLE [Users] (
    UserID int IDENTITY(1,1) PRIMARY KEY,
    Username NVARCHAR(20) NOT NULL,
    [Password] NVARCHAR(100) NOT NULL, -- Check size of hashed password
    UserType int NOT NULL,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    SchoolID int -- FK to school table
)
GO

-- Create category reference tables
CREATE TABLE GeneralInfo (
    InfoID int PRIMARY KEY,
    InfoName NVARCHAR(50) NOT NULL,
)
GO

CREATE TABLE HealthCondition (
    ConditionID int PRIMARY KEY,
    ConditionCatID int NOT NULL,
    ConditionName NVARCHAR(50) NOT NULL
)
GO

CREATE TABLE FunctionalAbility (
    AbilityID int PRIMARY KEY,
    AbilityName NVARCHAR(50) NOT NULL
)
GO

-- Create citizen table
CREATE TABLE Citizen (
    CitizenID int IDENTITY(1,1) PRIMARY KEY,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
)

-- Create Citizen to category table
CREATE TABLE CitizenInfo (
    CitizenID int FOREIGN KEY REFERENCES Citizen(CitizenID),
    InfoID int FOREIGN KEY REFERENCES GeneralInfo(InfoID),
    InfoText NVARCHAR(MAX),
    CONSTRAINT PK_CitizenInfo PRIMARY KEY (CitizenID, InfoID)
)
GO

CREATE TABLE CitizenCondition (
    CitizenID int FOREIGN KEY REFERENCES Citizen(CitizenID),
    ConditionID int FOREIGN KEY REFERENCES HealthCondition(ConditionID),
    ConditionStatus int NOT NULL,
    ConditionNote NVARCHAR(MAX),
    ConditionAssessment NVARCHAR(MAX),
    ConditionExpectation NVARCHAR(20),
    CONSTRAINT PK_CitizenCondition PRIMARY KEY (CitizenID, ConditionID)
)
GO

CREATE TABLE CitizenAbility (
    CitizenID int FOREIGN KEY REFERENCES Citizen(CitizenID),
    AbilityID int FOREIGN KEY REFERENCES FunctionalAbility(AbilityID),
    CurrentLevel int NOT NULL,
    ExpectedLevel int NOT NULL,
    AbilityNote NVARCHAR(MAX) NOT NULL,
    CitizenExecution int NOT NULL,
    CitizenLimitation BIT NOT NULL,
    CitizenGoal NVARCHAR(MAX) NOT NULL,
    CONSTRAINT PK_CitizenAbility PRIMARY KEY (CitizenID, AbilityID)
)
GO

-- Create Student to citizen table
CREATE TABLE StudentCitizen(
    UserID int FOREIGN KEY REFERENCES Users(UserID),
    CitizenID int FOREIGN KEY REFERENCES Citizen(CitizenID),
    CONSTRAINT PK_StudentCitizen PRIMARY KEY (UserID, CitizenID)
)
GO


-- Test Users
INSERT INTO Users (Username, [Password], UserType, FirstName, LastName, SchoolID)
VALUES ('admin', 'pass', 1, 'firstname', 'lastname', null)
GO
INSERT INTO Users (Username, [Password], UserType, FirstName, LastName, SchoolID)
VALUES ('teacher', 'pass', 2, 'firstname', 'lastname', 1)
GO
INSERT INTO Users (Username, [Password], UserType, FirstName, LastName, SchoolID)
VALUES ('student', 'pass', 3, 'firstname', 'lastname', 1)
GO

-- Test Citizen
INSERT INTO Citizen (FirstName, LastName)
VALUES ('Peter', 'Hansen')
GO
INSERT INTO StudentCitizen (UserID, CitizenID)
VALUES (3, 1)
GO

-- Citizen care info tables
INSERT INTO GeneralInfo (InfoID, InfoName)
VALUES (1, 'Mestring'),
(2, 'Motivation'),
(3, 'Ressourcer'),
(4, 'Roller'),
(5, 'Vaner'),
(6, 'Uddannelse og job'),
(7, 'Livshistorie'),
(8, 'Netværk'),
(9, 'Helbredsoplysninger'),
(10, 'Hjælpemidler'),
(11, 'Boligens indretning')
GO

INSERT INTO HealthCondition (ConditionID, ConditionCatID, ConditionName)
VALUES
(1, 1, 'Problemer med personlig pleje')